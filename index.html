<!DOCTYPE html>

<html lang="fr"><head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<meta charset="utf-8"/>
<!-- Mise √† jour du titre de la page pour refl√©ter l'exercice avec un drapeau japonais -->
<title>Exercice Hiragana </title>
<style>
    body { font-family: sans-serif; background: #f2f2f2; padding: 20px; text-align: center; }
    .instruction { font-size: 1.2em; margin-bottom: 10px; }
    .grid-container { display: grid; gap: 5px; justify-content: center; margin-bottom: 5px; width: fit-content; margin-left: auto; margin-right: auto; }
    .romaji-box { height: 20px; font-size: 14px; line-height: 20px; text-align: center; width: 40px; }
    .box { width: 40px; height: 40px; border: 2px solid #333; font-size: 24px; line-height: 40px; background-color: white; text-align: center; }
    .box.correct { background-color: #c8f7c5; }
    .box.incorrect { background-color: #f9c0c0; }
    #buttons { margin-top: 10px; }
    #buttons button { margin: 5px; font-size: 20px; padding: 5px 10px; }
    #buttons button:disabled { background-color: #d0e6ff; color: #555; }
    .buttons { margin-top: 30px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
    .buttons button { font-size: 24px; padding: 12px 24px; border-radius: 10px; background-color: #eeeeee; border: 2px solid #aaa; }
    .buttons button:hover { background-color: #d8eaff; cursor: pointer; }
    .feedback { font-weight: bold; font-size: 1.2em; margin-top: 15px; }
    /* Style pour le titre principal de la page */
    h1#appTitle {
      font-size: 2em;
      margin-bottom: 20px;
    }
    #appTitle {
      text-align: center;
      margin-bottom: 20px;
    }

    .title-main {
      font-size: 2em;
      font-weight: bold;
    }

    .title-signature {
      font-size: 0.9em;
      color: #666;
      font-family: serif;
      opacity: 0.8;
      margin-top: 4px; 
    }

    /* Indicateur discret de position de la phrase */
    .phrase-counter {
      font-size: 0.9em;
      color: #666;
      margin-top: 10px;
    }
    /* Styling for the instruction lines: romaji (normal), Japanese (red) and hidden by default, and French (dark blue) */
    .romaji-line {
      font-style: normal;
      font-weight: normal;
    }
    .jp-line {
      color: red;
      font-weight: normal;
      display: none; /* hidden until the user provides a correct answer */
    }
    .fr-line {
      color: #00008B;
      font-weight: normal;
    }
  
    .highlight-preview {
      background-color: #fff5c2 !important;
      box-shadow: 0 0 8px #f0c040;
      transform: scale(1.05);
      transition: transform 0.1s ease;
    }
    
    .action-button {
      font-size: 1.2em;
      padding: 0.4em 1em;
      margin: 0.2em;
      border-radius: 8px;
      border: 2px solid #888;
      background-color: #f0f0f0;
      transition: background-color 0.2s ease;
    }
    .action-button:hover {
      background-color: #e0e0e0 !important;
    }
    .help-button {
      background-color: #d5f5d5 !important;
    }
    .help-button:disabled {
      background-color: #cccccc !important;
      cursor: not-allowed;
      opacity: 0.6;
    }

    .buttons-row {
      display: flex;
      flex-direction: column;
      gap: 20px;
      align-items: center;
      margin-top: 30px;
    }

    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    @media (min-width: 600px) {
      .buttons-row {
        flex-direction: column;
        align-items: center;
      }

      .button-group {
        flex-direction: row;
        justify-content: center;
      }
    }
</style>
</head>
<body>
<!-- Titre principal affich√© en haut de la page -->
<div id="appTitle">
<div class="title-main">Exercice Hiragana </div>
<div class="title-signature">ÂøóÁë†Áúü‰πÖ ‰Ωú</div>
</div>
<div class="instruction" id="instruction"><p>Erreur de chargement des donn√©es.</p></div>
<!-- Removed the standalone jpPhrase element because the Japanese text will now be
       displayed inside the instruction block itself when appropriate. -->
<!-- <div class="feedback" id="jpPhrase" style="color: red;"></div> -->
<div class="grid-container" id="romaji-container"></div>
<div class="grid-container" id="phrase-container"></div>
<div id="buttons"></div>
<div class="buttons-row">
<div class="button-group">
<!--
        Bouton ¬´¬†reprendre¬†¬ª : n'est affich√© que lorsqu'une r√©ponse erron√©e
        est d√©tect√©e lors de la v√©rification. Il se place juste √† gauche
        du bouton V√©rifier et affiche uniquement une ic√¥ne ¬´¬†üò©¬†¬ª. Au clic,
        il efface toutes les cases incorrectes et restaure les boutons de
        kana correspondants, mimant l'action d'annuler ces entr√©es.
      -->
<button class="action-button help-button" id="resumeButton" onclick="resumeIncorrect()" style="display: none;" title="R√©initialiser uniquement les erreurs">üò©</button>
<button class="action-button help-button" disabled="disabled" id="checkButton" onclick="checkAnswer()">V√©rifier</button>
<button class="action-button" id="resetButton" onclick="clearBoxes()" title="R√©initialiser la saisie"><span style="color:red">RAZ</span></button>
<button class="action-button" id="backspaceButton" onclick="undoLast()" title="Annuler la derni√®re lettre">‚Üê</button>
<button class="action-button help-button" id="hintButton" onmousedown="showHint()" onmouseup="hideHint()" ontouchend="hideHint()" ontouchstart="showHint()" title="Afficher un indice temporaire">üí°</button>
<button class="action-button help-button" id="solutionButton" onmousedown="showSolutionPreview()" onmouseup="restorePreviousState()" ontouchend="restorePreviousState()" ontouchstart="showSolutionPreview()" title="Afficher temporairement la solution">üëÅÔ∏è</button>
</div>
<div class="button-group">
<button class="action-button" id="prevButton" onclick="prevPhrase()" title="Phrase pr√©c√©dente">‚¨ÖÔ∏è</button>
<button class="action-button" id="nextButton" onclick="nextPhrase()" title="Phrase suivante">‚û°Ô∏è</button>
<button class="action-button" id="randomButton" onclick="randomPhrase()" title="Phrase al√©atoire">üé≤</button>
</div>
</div>
<div class="feedback" id="feedback"></div>
<!-- Indicateur discret affichant la position actuelle de la phrase -->
<div class="phrase-counter" id="phraseCounter"></div>
<div class="feedback" style="font-style: italic; font-weight: normal;">Aides utilis√©es ici : <span id="hintCount">0</span><br/>
    Solutions consult√©es; total : <span id="solutionCount">0</span><br/>
     - dont ici - : <span id="localSolutionCount">0</span></div>
<script>
    let phrases = [], currentIndex = 0, boxes = [], romajiBoxes = [], clickHistory = [], hintCount = 0;
    let hintActive = false, lastHintedBox = null;

    const phraseContainer = document.getElementById('phrase-container');
    const romajiContainer = document.getElementById('romaji-container');
    const buttonsContainer = document.getElementById('buttons');
    const instruction = document.getElementById('instruction');
    const feedback = document.getElementById('feedback');
    const hintCountSpan = document.getElementById('hintCount');
    const checkButton = document.getElementById('checkButton');
    const clickAudio = new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAD//f39/f39");
    // √âl√©ment d'indicateur de num√©ro de phrase
    const phraseCounter = document.getElementById('phraseCounter');

    const charToRomaji = {
      '„ÅÇ':'a','„ÅÑ':'i','„ÅÜ':'u','„Åà':'e','„Åä':'o','„Åã':'ka','„Åç':'ki','„Åè':'ku','„Åë':'ke','„Åì':'ko',
      '„Åå':'ga','„Åé':'gi','„Åê':'gu','„Åí':'ge','„Åî':'go','„Åï':'sa','„Åó':'shi','„Åô':'su','„Åõ':'se','„Åù':'so',
      '„Åñ':'za','„Åò':'ji','„Åö':'zu','„Åú':'ze','„Åû':'zo','„Åü':'ta','„Å°':'chi','„Å§':'tsu','„Å¶':'te','„Å®':'to',
      '„Å†':'da','„Åß':'de','„Å©':'do','„Å™':'na','„Å´':'ni','„Å¨':'nu','„Å≠':'ne','„ÅÆ':'no','„ÅØ':'ha','„Å≤':'hi',
      '„Åµ':'fu','„Å∏':'he','„Åª':'ho','„Å∞':'ba','„Å≥':'bi','„Å∂':'bu','„Åπ':'be','„Åº':'bo','„Åæ':'ma','„Åø':'mi',
      '„ÇÄ':'mu','„ÇÅ':'me','„ÇÇ':'mo','„ÇÑ':'ya','„ÇÜ':'yu','„Çà':'yo','„Çâ':'ra','„Çä':'ri','„Çã':'ru','„Çå':'re',
      '„Çç':'ro','„Çè':'wa','„Çí':'o','„Çì':'n','„Å£':'','„ÇÉ':'ya','„ÇÖ':'yu','„Çá':'yo','„Éº':'', '„Äú':'',
      '„Éï':'fu','„É©':'ra','„É≥':'n','„Çπ':'su','„Ç∏':'ji','„Éß':'yo','„Éà':'to','„Ç´':'ka','„Éâ':'do'
    };

    function hiraganaToRomajiCluster(cluster) {
      return cluster.split('').map(c => charToRomaji[c] || '').join('');
    }

    function loadPhrase(index) {
  const backBtn = document.getElementById("backspaceButton");
  if (backBtn) backBtn.disabled = false;
  const hintBtn = document.getElementById("hintButton");
  const solBtn = document.getElementById("solutionButton");
  if (hintBtn) hintBtn.disabled = false;
  if (solBtn) solBtn.disabled = false;
  document.getElementById("hintButton").disabled = false;
  document.getElementById("solutionButton").disabled = false;
      const localSpan = document.getElementById('localSolutionCount');
      if (localSpan) localSpan.textContent = '0';
      const phrase = phrases[index];
      const rawChars = phrase.kana.trim().split(' ');
      const romajiList = rawChars.map(hiraganaToRomajiCluster);
      boxes = []; romajiBoxes = []; clickHistory = [];
      hintCount = 0;
      hintCountSpan.textContent = hintCount;
      feedback.textContent = '';
      // Hide any previously displayed Japanese phrase at the start of a new phrase.
      const jpReset = document.getElementById('jpPhrase');
      if (jpReset) {
        jpReset.textContent = '';
        jpReset.style.display = 'none';
      }
      checkButton.disabled = true;
      // Cacher le bouton "reprendre" au chargement d'une nouvelle phrase
      const resumeBtnInit = document.getElementById('resumeButton');
      if (resumeBtnInit) {
        resumeBtnInit.style.display = 'none';
      }
      // Construct the instruction block with romaji, a placeholder for the Japanese phrase,
      // and the French translation. The Japanese line remains hidden until the answer
      // is validated as correct.
      instruction.innerHTML =
        `<p class="romaji-line">${phrase.romaji}</p>` +
        `<p id="jpPhrase" class="jp-line"></p>` +
        `<p class="fr-line">${phrase.fr}</p>`;

      // Mettre √† jour l'indicateur de position de la phrase
      if (phraseCounter) {
        phraseCounter.textContent = `Phrase ${index + 1} / ${phrases.length}`;
      }

      phraseContainer.style.gridTemplateColumns = `repeat(${rawChars.length}, 40px)`;
      romajiContainer.style.gridTemplateColumns = `repeat(${rawChars.length}, 40px)`;
      phraseContainer.innerHTML = ''; romajiContainer.innerHTML = ''; buttonsContainer.innerHTML = '';

      rawChars.forEach((_, i) => {
        const rBox = document.createElement('div');
        rBox.className = 'romaji-box';
        romajiContainer.appendChild(rBox);
        romajiBoxes.push(rBox);
        const box = document.createElement('div');
        box.className = 'box';
        phraseContainer.appendChild(box);
        boxes.push(box);
      });

      const shuffled = rawChars.slice().sort(() => Math.random() - 0.5);
      shuffled.forEach(char => {
        const btn = document.createElement('button');
        btn.textContent = char;
        btn.onclick = () => { clickAudio.play(); insertCharacter(char, btn); };
        buttonsContainer.appendChild(btn);
      });

      boxes.correct = rawChars;
      boxes.romajiList = romajiList;
    }

    function insertCharacter(char, button) {
      const emptyBox = boxes.find(b => b.textContent === '');
      if (emptyBox) {
        emptyBox.textContent = char;
        button.disabled = true;
        clickHistory.push({box: emptyBox, button});
        updateCheckButtonState();
      }
    }

    function updateCheckButtonState() {
      checkButton.disabled = !boxes.every(b => b.textContent !== '');
    }

    function checkAnswer() {
  const backBtn = document.getElementById("backspaceButton");
  const hintBtn = document.getElementById("hintButton");
  const solBtn = document.getElementById("solutionButton");
      boxes.forEach((box, i) => {
        box.classList.remove('correct', 'incorrect');
        if (box.textContent === boxes.correct[i]) {
          box.classList.add('correct');
          romajiBoxes[i].textContent = boxes.romajiList[i] || '';
        } else {
          box.classList.add('incorrect');
          romajiBoxes[i].textContent = '';
        }
      });
      const result = boxes.map(b => b.textContent).join('') === boxes.correct.join('');
      feedback.textContent = result ? '‚úÖ Bravo !' : '‚ùå Essaie encore';
      // G√©rer l'affichage du bouton "reprendre" selon le r√©sultat et la pr√©sence d'erreurs.
      const resumeBtn = document.getElementById('resumeButton');
      if (!result && boxes.some(b => b.classList.contains('incorrect'))) {
        // Afficher le bouton uniquement si des cases sont incorrectes.
        if (resumeBtn) {
          resumeBtn.style.display = 'inline-block';
        }
      } else {
        if (resumeBtn) {
          resumeBtn.style.display = 'none';
        }
      }

      // Afficher la phrase japonaise seulement si tout est correct
      const jpElement = document.getElementById('jpPhrase');
      if (result) {
        jpElement.textContent = phrases[currentIndex].jp;
        jpElement.style.display = 'block';
        if (hintBtn) hintBtn.disabled = true;
        if (solBtn) solBtn.disabled = true;
        if (backBtn) backBtn.disabled = true;
      } else {
        jpElement.textContent = '';
        jpElement.style.display = 'none';
        if (hintBtn) hintBtn.disabled = false;
        if (solBtn) solBtn.disabled = false;
        if (backBtn) backBtn.disabled = false;
      }
    }

    function clearBoxes() {
  const backBtn = document.getElementById("backspaceButton");
  if (backBtn) backBtn.disabled = false;
  const hintBtn = document.getElementById("hintButton");
  const solBtn = document.getElementById("solutionButton");
  if (hintBtn) hintBtn.disabled = false;
  if (solBtn) solBtn.disabled = false;
  document.getElementById("hintButton").disabled = false;
  document.getElementById("solutionButton").disabled = false;
      boxes.forEach((box, i) => {
        box.textContent = '';
        box.classList.remove('correct', 'incorrect');
        romajiBoxes[i].textContent = '';
      });
      document.querySelectorAll('#buttons button').forEach(b => b.disabled = false);
      clickHistory = [];
      feedback.textContent = '';
      // Hide the Japanese phrase when clearing the boxes.
      const jpElement = document.getElementById('jpPhrase');
      if (jpElement) {
        jpElement.textContent = '';
        jpElement.style.display = 'none';
      }
      updateCheckButtonState();

      // Masquer le bouton "reprendre" lorsque l'on r√©initialise tout
      const resumeBtn = document.getElementById('resumeButton');
      if (resumeBtn) {
        resumeBtn.style.display = 'none';
      }
    }

    function undoLast() {
      const last = clickHistory.pop();
      if (last) {
        const idx = boxes.indexOf(last.box);
        last.box.textContent = '';
        romajiBoxes[idx].textContent = '';
        last.box.classList.remove('correct', 'incorrect');
        last.button.disabled = false;
        updateCheckButtonState();
      }
      // Hide the Japanese phrase whenever the user interacts with the undo button.
      const jpElement = document.getElementById('jpPhrase');
      if (jpElement) {
        jpElement.textContent = '';
        jpElement.style.display = 'none';
      }
    }

    /**
     * Efface toutes les lettres positionn√©es dans des cases incorrectes et
     * r√©active les boutons correspondants. Cette fonction est appel√©e
     * lorsqu'on clique sur le bouton "reprendre" (üò©). Elle parcourt
     * l'historique des clics pour identifier les entr√©es qui se trouvent
     * dans des cases marqu√©es comme incorrectes (classe CSS ¬´¬†incorrect¬†¬ª),
     * puis r√©tablit l'√©tat initial de ces cases et des boutons de kana.
     */
    function resumeIncorrect() {
      // Parcourir l'historique en sens inverse pour supprimer les entr√©es
      // sans perturber les indices restants.
      for (let i = clickHistory.length - 1; i >= 0; i--) {
        const entry = clickHistory[i];
        const box = entry.box;
        if (box.classList.contains('incorrect')) {
          // R√©initialiser la case et le romaji correspondant
          const idx = boxes.indexOf(box);
          box.textContent = '';
          if (idx !== -1) {
            romajiBoxes[idx].textContent = '';
          }
          // Retirer les classes d'√©tat
          box.classList.remove('correct', 'incorrect');
          // R√©activer le bouton de kana
          if (entry.button) {
            entry.button.disabled = false;
          }
          // Retirer cette entr√©e de l'historique
          clickHistory.splice(i, 1);
        }
      }
      // Cacher la phrase japonaise et le bouton "reprendre"
      const jpElement = document.getElementById('jpPhrase');
      if (jpElement) {
        jpElement.textContent = '';
        jpElement.style.display = 'none';
      }
      // Mettre √† jour l'√©tat du bouton V√©rifier
      updateCheckButtonState();
      // Masquer le bouton reprendre apr√®s utilisation
      const resumeBtn = document.getElementById('resumeButton');
      if (resumeBtn) {
        resumeBtn.style.display = 'none';
      }
    }

    function showHint() {
      // Hide the Japanese phrase when requesting a hint.
      const jpElement = document.getElementById('jpPhrase');
      if (jpElement) {
        jpElement.textContent = '';
        jpElement.style.display = 'none';
      }
      const i = boxes.findIndex(b => b.textContent === '');
      if (i !== -1) {
        lastHintedBox = boxes[i];
        lastHintedBox.textContent = boxes.correct[i];
        lastHintedBox.style.opacity = '0.5';
        hintCount++;
        hintCountSpan.textContent = hintCount;
        hintActive = true;
      }
    }

    function hideHint() {
      if (hintActive && lastHintedBox) {
        lastHintedBox.textContent = '';
        lastHintedBox.style.opacity = '1';
        lastHintedBox = null;
        hintActive = false;
      }
      // Hide the Japanese phrase when the hint is released.
      const jpElement = document.getElementById('jpPhrase');
      if (jpElement) {
        jpElement.textContent = '';
        jpElement.style.display = 'none';
      }
    }

    function nextPhrase() {
      currentIndex = (currentIndex + 1) % phrases.length;
      loadPhrase(currentIndex);
      // Hide the Japanese phrase when moving to the next phrase.
      const jpElement = document.getElementById('jpPhrase');
      if (jpElement) {
        jpElement.textContent = '';
        jpElement.style.display = 'none';
      }
    }

    // Naviguer vers la phrase pr√©c√©dente
    function prevPhrase() {
      currentIndex = (currentIndex - 1 + phrases.length) % phrases.length;
      loadPhrase(currentIndex);
      // Cacher la phrase japonaise lors du passage √† la phrase pr√©c√©dente
      const jpElement = document.getElementById('jpPhrase');
      if (jpElement) {
        jpElement.textContent = '';
        jpElement.style.display = 'none';
      }
    }

    // Choisir une phrase al√©atoire
    function randomPhrase() {
      if (!phrases || phrases.length === 0) return;
      let randIndex = Math.floor(Math.random() * phrases.length);
      // √©viter de r√©p√©ter la m√™me phrase imm√©diatement si possible
      if (phrases.length > 1 && randIndex === currentIndex) {
        randIndex = (randIndex + 1) % phrases.length;
      }
      currentIndex = randIndex;
      loadPhrase(currentIndex);
      // Cacher la phrase japonaise puisqu'une nouvelle phrase est tir√©e
      const jpElement = document.getElementById('jpPhrase');
      if (jpElement) {
        jpElement.textContent = '';
        jpElement.style.display = 'none';
      }
    }

    fetch("phrases_100.json")
      .then(res => res.json())
      .then(json => { phrases = json; loadPhrase(currentIndex); })
      .catch(e => { instruction.innerHTML = "<p>Erreur de chargement des donn√©es.</p>"; console.error(e); });
  
    let savedState = [];
    let totalSolutionCount = 0;

    function showSolutionPreview() {
      const totalSpan = document.getElementById('solutionCount');
      const localSpan = document.getElementById('localSolutionCount');

      totalSolutionCount++;
      if (totalSpan) totalSpan.textContent = totalSolutionCount;
      if (localSpan) localSpan.textContent = parseInt(localSpan.textContent || '0') + 1;

      if (totalSolutionCount === 5) {
        alert("üëÅÔ∏è Tu aimes un peu trop tricher, non ? üòÑ");
      }

      savedState = boxes.map((box, i) => ({
        text: box.textContent,
        classList: [...box.classList],
        romaji: romajiBoxes[i].textContent
      }));

      boxes.forEach((box, i) => {
        box.textContent = boxes.correct[i];
        box.classList.remove('incorrect');
        box.classList.add('correct', 'highlight-preview');
        romajiBoxes[i].textContent = boxes.romajiList[i];
      });
    }

    function restorePreviousState() {
      savedState.forEach((state, i) => {
        boxes[i].textContent = state.text;
        boxes[i].className = 'box';
        state.classList.forEach(cls => boxes[i].classList.add(cls));
        boxes[i].classList.remove('highlight-preview');
        romajiBoxes[i].textContent = state.romaji;
      });
    }

</script>
<div id="macronInfo" style="display:none; position: fixed; top: 10%; left: 50%; transform: translateX(-50%);
    background-color: #fff; border: 2px solid #666; padding: 1em; border-radius: 10px;
    max-width: 90%; box-shadow: 0 0 10px rgba(0,0,0,0.3); z-index: 9999;">
<p style="font-size: 1em; text-align:left;">
    Dans certains mots (comme ici) contenant "ou", comme <strong>gakkou</strong>, la transcription correcte selon le syst√®me Hepburn est <strong>gakk≈ç</strong> (avec un ≈ç long).
    <br/><br/>Mais ici, nous utilisons <strong>gakkou</strong> car cela correspond mieux √† la structure en hiragana :<br/> „Åå (ga) + „Å£ (petit tsu) + „Åì (ko) + „ÅÜ (u).
    <br/><br/>Cela facilite l‚Äôapprentissage de l‚Äô√©criture en japonais - et c'est incontournable pour cet exercice ;-)
  </p>
<button onclick="document.getElementById('macronInfo').style.display='none';" style="margin-top: 10px; padding: 6px 12px;">Fermer</button>
</div>
<script>
function maybeAddInfoButton() {
  const romajiEl = document.querySelector('.romaji-line');
  if (!romajiEl) return;
  const existingBtn = document.getElementById('infoButton');
  if (existingBtn) existingBtn.remove();

  if (romajiEl.textContent.includes("ou")) {
    const infoBtn = document.createElement("button");
    infoBtn.textContent = "‚ÑπÔ∏è";
    infoBtn.title = "Pourquoi 'gakkou' et pas 'gakk≈ç' ?";
    infoBtn.id = "infoButton";
    infoBtn.style.marginLeft = "10px";
    infoBtn.style.fontSize = "0.9em";
    infoBtn.style.cursor = "pointer";
    infoBtn.onclick = () => {
      document.getElementById("macronInfo").style.display = "block";
    };
    romajiEl.appendChild(infoBtn);
  }
}

// Intercepter loadPhrase pour y ins√©rer l‚Äôappel √† maybeAddInfoButton
const originalLoadPhrase = loadPhrase;
loadPhrase = function(index) {
  originalLoadPhrase(index);
  setTimeout(maybeAddInfoButton, 30);
}

// üìã Bouton Infos et popup
const titleDiv = document.querySelector('#appTitle .title-main');
if (titleDiv) {
  const infosBtn = document.createElement('button');
  infosBtn.textContent = 'üìã';
  infosBtn.id = 'usageInfoBtn';
  infosBtn.style.fontSize = '1em';
  infosBtn.style.marginLeft = '10px';
  infosBtn.style.cursor = 'pointer';
  infosBtn.title = 'Afficher la fiche d\'utilisation';
  infosBtn.onclick = () => {
    document.getElementById('usagePopup').style.display = 'block';
  };
  titleDiv.appendChild(infosBtn);
}

// Ajouter la bo√Æte popup √† la fin du body
const usageDiv = document.createElement('div');
usageDiv.id = 'usagePopup';
usageDiv.style.display = 'none';
usageDiv.style.position = 'fixed';
usageDiv.style.top = '10%';
usageDiv.style.left = '50%';
usageDiv.style.transform = 'translateX(-50%)';
usageDiv.style.backgroundColor = '#fff';
usageDiv.style.border = '2px solid #666';
usageDiv.style.padding = '1em';
usageDiv.style.borderRadius = '10px';
usageDiv.style.maxWidth = '90%';
usageDiv.style.maxHeight = '80%';
usageDiv.style.overflowY = 'auto';
usageDiv.style.boxShadow = '0 0 10px rgba(0,0,0,0.3)';
usageDiv.style.zIndex = '9999';
usageDiv.innerHTML = `<div style="text-align:center;">
  <h2 style="margin-top:0; text-align:center;">Fiche d'utilisation</h2>
  <p style="font-style:italic; font-size:1em; text-align:center;">par CilMac ‚Äì juillet 2025</p>
  <div style="text-align:left;">
    <h3>üéØ Objectif</h3>
    <p>S'entra√Æner √† reconstituer des phrases japonaises simples en <strong>hiragana</strong>, √† partir de leur <em>romaji</em> et de leur traduction fran√ßaise.</p>

    <h3>üß© Fonctionnement de base</h3>
    <ol>
      <li>Une phrase en <strong>romaji</strong> + traduction fran√ßaise est affich√©e.</li>
      <li>Des boutons m√©lang√©s proposent les <strong>hiragana</strong> √† cliquer dans l'ordre.</li>
      <li>Quand toutes les cases sont remplies, le bouton <strong>V√©rifier</strong> s‚Äôactive.</li>
      <li>Si c'est juste ‚Üí tout passe en vert. Sinon ‚Üí erreurs en rouge.</li>
    </ol>

    <h3>‚ú® Fonctions utiles</h3>
    <ul>
      <li><strong>üò© Reprendre</strong> : efface uniquement les cases incorrectes.</li>
      <li><strong>üí° Indice</strong> : propose un caract√®re correct temporaire.</li>
      <li><strong>üëÅÔ∏è Solution</strong> : affiche temporairement la r√©ponse compl√®te.</li>
      <li><strong>‚Üê Annuler</strong> : retire la derni√®re lettre saisie.</li>
      <li><strong>RAZ</strong> : recommence la phrase en cours.</li>
	<li><strong>Rafra√Æchir</strong> la page Web : nouvelle session, repart √† z√©ro.</li>
    </ul>

    <h3>üìÇ Donn√©es</h3>
    <p>Les phrases viennent du fichier <code>phrases_100.json</code> (hiragana + romaji + fran√ßais).</p>

    <h3>‚ÑπÔ∏è Astuce</h3>
    <p>Parfois <code>gakkou</code> est affich√© au lieu de <code>gakk≈ç</code> : c‚Äôest pour mieux coller aux hiragana.</p>

    <h3></li>
    </ul>
  </div>
</div>
<button onclick="document.getElementById('usagePopup').style.display='none';" style="margin-top: 10px; padding: 6px 12px;">Fermer</button>`;
document.body.appendChild(usageDiv);
</script></body></html>
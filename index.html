<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Exercice Hiragana</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f2f2f2;
      padding: 20px;
      text-align: center;
    }
    .instruction {
      font-size: 1.2em;
      margin-bottom: 10px;
    }
    .grid-container {
      display: grid;
      grid-template-columns: repeat(9, 50px);
      gap: 5px;
      justify-content: center;
      margin-bottom: 5px;
      width: fit-content;
      margin-left: auto;
      margin-right: auto;
    }
    .romaji-box {
      height: 20px;
      font-size: 14px;
      line-height: 20px;
      text-align: center;
    }
    .box {
      width: 50px;
      height: 50px;
      border: 2px solid #333;
      font-size: 24px;
      line-height: 50px;
      background-color: white;
      text-align: center;
    }
    .box.correct { background-color: #c8f7c5; }
    .box.incorrect { background-color: #f9c0c0; }
    #buttons { margin-top: 10px; }
    #buttons button {
      margin: 5px;
      font-size: 20px;
      padding: 5px 10px;
    }
    .buttons button {
      font-size: 20px;
      padding: 10px 20px;
      margin: 8px;
      border-radius: 8px;
    }

    #buttons button:disabled {
      background-color: #d0e6ff;
      color: #555;
    }
    .feedback {
      font-weight: bold;
      font-size: 1.2em;
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <div class="instruction">
    <p><em>Soko wa gakkou desu</em></p>
    <p><strong>L√†, c‚Äôest une √©cole.</strong></p>
  </div>
  <div class="grid-container" id="romaji-container"></div>
  <div class="grid-container" id="phrase-container"></div>
  <div id="buttons"></div>
  <div class="buttons">
    <button id="checkButton" onclick="checkAnswer()" disabled>V√©rifier</button>
    <button onclick="clearBoxes()">Effacer</button>
    <button onclick="undoLast()">‚Üê</button>
    <button id="hintButton" onmousedown="showHint()" onmouseup="hideHint()" ontouchstart="showHint()" ontouchend="hideHint()">üí°</button>
  </div>
  <div class="feedback" id="feedback"></div>
  <div class="feedback">Aides utilis√©es : <span id="hintCount">0</span></div>

  <script>
    const correctPhrase = ['„Åù','„Åì','„ÅØ','„Åå','„Å£','„Åì','„ÅÜ','„Åß','„Åô'];
    const hiraganaOptions = ['„Åù','„Åì','„ÅØ','„Åå','„Å£','„Åì','„ÅÜ','„Åß','„Åô'].sort(() => Math.random() - 0.5);
    const romajiMap = {'„Åù':'so','„Åì':'ko','„ÅØ':'wa','„Åå':'ga','„Å£':'','„ÅÜ':'u','„Åß':'de','„Åô':'su'};
    const phraseContainer = document.getElementById('phrase-container');
    const romajiContainer = document.getElementById('romaji-container');
    const buttonsContainer = document.getElementById('buttons');
    const feedback = document.getElementById('feedback');
    const boxes = [], romajiBoxes = [], clickHistory = [];
    let hintCount = 0;
    let hintActive = false;
    let lastHintedBox = null;
    const clickAudio = new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAD//f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39");

    function init() {
      phraseContainer.innerHTML = '';
      romajiContainer.innerHTML = '';
      buttonsContainer.innerHTML = '';
      feedback.textContent = '';
      boxes.length = 0; romajiBoxes.length = 0; clickHistory.length = 0;
      document.getElementById('hintCount').textContent = '0';
      document.getElementById('checkButton').disabled = true;

      for (let i = 0; i < correctPhrase.length; i++) {
        const romajiBox = document.createElement('div');
        romajiBox.className = 'romaji-box';
        romajiBox.textContent = '';
        romajiContainer.appendChild(romajiBox);
        romajiBoxes.push(romajiBox);

        const box = document.createElement('div');
        box.className = 'box';
        box.textContent = '';
        phraseContainer.appendChild(box);
        boxes.push(box);
      }

      hiraganaOptions.forEach(char => {
        const btn = document.createElement('button');
        btn.textContent = char;
        btn.onclick = () => { clickAudio.play(); insertCharacter(char, btn); };
        buttonsContainer.appendChild(btn);
      });
    }

    function insertCharacter(char, button) {
      const emptyBox = boxes.find(b => b.textContent === '');
      if (emptyBox) {
        emptyBox.textContent = char;
        button.disabled = true;
        clickHistory.push({box: emptyBox, button});
        updateCheckButtonState();
      }
    }

    function updateCheckButtonState() {
      document.getElementById('checkButton').disabled = !boxes.every(b => b.textContent !== '');
    }

    function checkAnswer() {
      const userAnswer = boxes.map(b => b.textContent).join('');
      const correct = correctPhrase.join('');
      boxes.forEach((box, i) => {
        box.classList.remove('correct', 'incorrect');
        if (box.textContent === correctPhrase[i]) {
          box.classList.add('correct');
        } else {
          box.classList.add('incorrect');
        }
        romajiBoxes[i].textContent = box.textContent === '„Å£' ? '' : romajiMap[box.textContent] || '';
      });
      feedback.textContent = userAnswer === correct ? '‚úÖ Bravo !' : '‚ùå Essaie encore';
    }

    function clearBoxes() {
      boxes.forEach((box, i) => {
        box.textContent = '';
        box.classList.remove('correct', 'incorrect');
        romajiBoxes[i].textContent = '';
      });
      document.querySelectorAll('#buttons button').forEach(b => b.disabled = false);
      clickHistory.length = 0;
      feedback.textContent = '';
      updateCheckButtonState();
    }

    function undoLast() {
      const last = clickHistory.pop();
      if (last) {
        const idx = boxes.indexOf(last.box);
        last.box.textContent = '';
        romajiBoxes[idx].textContent = '';
        last.box.classList.remove('correct', 'incorrect');
        last.button.disabled = false;
        updateCheckButtonState();
      }
    }

    function showHint() {
      const i = boxes.findIndex(b => b.textContent === '');
      if (i !== -1) {
        lastHintedBox = boxes[i];
        lastHintedBox.textContent = correctPhrase[i];
        lastHintedBox.style.opacity = '0.5';
        hintCount++;
        document.getElementById('hintCount').textContent = hintCount;
        hintActive = true;
      }
    }

    function hideHint() {
      if (hintActive && lastHintedBox) {
        lastHintedBox.textContent = '';
        lastHintedBox.style.opacity = '1';
        lastHintedBox = null;
        hintActive = false;
      }
    }

    init();
  </script>
</body>
</html>